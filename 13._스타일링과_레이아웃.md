# 13. 스타일링과 레이아웃

## 1) 글로벌 스타일 & CSS-in-JS 개요

### 글로벌 스타일

* **전역 CSS 파일**(예: `styles/globals.css`)을 `_app.tsx`에서 한 번만 import.
* **CSS 변수**(컬러/간격/폰트)를 `:root`에 정의하면 테마/일관성이 좋아짐.
* 일부 리셋/노멀라이즈는 전역에, 컴포넌트별 스타일은 **모듈/CSS-in-JS**로.

### CSS-in-JS (styled-components 예시)

* **컴포넌트 단위 스타일**을 TypeScript 안에서 선언.
* **props 기반 조건부 스타일**, **테마 토큰** 주입이 쉽고, 공용 UI를 만들기 편함.
* Next.js에서는 `next.config.js`에서 `compiler.styledComponents`를 활성화하면 SSR에 친화적.

### 레이아웃 컴포넌트

* Pages Router에서는 **공통 레이아웃**을 `components/Layout.tsx`로 만들고
  `_app.tsx`에서 **모든 페이지를 감싸기** 또는 **getLayout 패턴**으로 페이지별 레이아웃을 분기.

---

## 2) 프로젝트 생성 & 의존성 (Next.js + TypeScript)

```bash
# Next.js + TS + Pages Router
npx create-next-app@latest next-layout-ts --ts --no-app
cd next-layout-ts

# CSS-in-JS (styled-components)
npm i styled-components
# (v6는 타입 포함, v5를 쓰는 환경이라면: npm i -D @types/styled-components)
```

**`next.config.js`** — styled-components 최적화 활성화

```js
/** @type {import('next').NextConfig} */
const nextConfig = {
  compiler: { styledComponents: true },
};
module.exports = nextConfig;
```

---

## 3) 글로벌 스타일 작성

**`styles/globals.css`**

```css
:root{
  --bg: #ffffff;
  --fg: #0f172a;
  --muted: #64748b;
  --card: #ffffff;
  --border: #e2e8f0;
  --ring: 0 0 0 3px rgba(59,130,246,.3);
}

:root[data-theme="dark"]{
  --bg: #0b0f14;
  --fg: #e5e7eb;
  --muted: #9ca3af;
  --card: #0f1720;
  --border: #1f2937;
}

html, body, #__next { height: 100%; }
body{
  margin:0;
  background:var(--bg);
  color:var(--fg);
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", sans-serif;
  line-height:1.5;
}

a{ color:inherit; text-decoration:none; }
button{
  border:1px solid var(--border);
  background:var(--card);
  color:var(--fg);
  border-radius:10px;
  padding:8px 12px;
  cursor:pointer;
}
button:focus{ outline: var(--ring) solid 0; box-shadow: var(--ring); }
.container{ max-width: 960px; margin:0 auto; padding: 16px; }
.card{
  background: var(--card);
  border:1px solid var(--border);
  border-radius:16px;
  padding:16px;
}
.small{ color:var(--muted); font-size:12px; }
```

---

## 4) 레이아웃 컴포넌트 (Header/Footer 공통)

**디렉터리**

```
src/
├─ components/
│  ├─ Layout.tsx
│  └─ Badge.tsx
├─ pages/
│  ├─ _app.tsx
│  ├─ index.tsx
│  └─ about.tsx
└─ styles/globals.css
```

**`src/components/Layout.tsx`**

```tsx
import Link from 'next/link';
import { useRouter } from 'next/router';
import styled, { css } from 'styled-components';
import { useEffect } from 'react';

const HeaderWrap = styled.header`
  border-bottom: 1px solid var(--border);
  background: var(--card);
`;
const HeaderInner = styled.div`
  display:flex; gap:12px; align-items:center;
  height:56px; 
`;
const Brand = styled.strong`font-size:18px;`;

const Nav = styled.nav`
  margin-left:auto; display:flex; gap:8px;
  a{
    padding:6px 10px; border-radius:10px; border:1px solid var(--border);
    &.active{ background:#111827; color:#fff; border-color:#111827; }
  }
`;

const Main = styled.main`min-height: calc(100vh - 56px - 56px);`;
const FooterWrap = styled.footer`
  border-top: 1px solid var(--border);
  height:56px; display:flex; align-items:center; color:var(--muted);
`;

type Props = { children: React.ReactNode };

export default function Layout({ children }: Props) {
  const { pathname } = useRouter();

  // (선택) 다크모드 토글을 위해, OS 설정에 맞춰 초기 theme을 잡는 예시
  useEffect(() => {
    const m = window.matchMedia?.('(prefers-color-scheme: dark)');
    document.documentElement.setAttribute('data-theme', m?.matches ? 'dark' : 'light');
  }, []);

  return (
    <>
      <HeaderWrap>
        <div className="container">
          <HeaderInner>
            <Brand>Next Layout</Brand>
            <Nav>
              <Link href="/" className={pathname === '/' ? 'active' : ''}>Home</Link>
              <Link href="/about" className={pathname === '/about' ? 'active' : ''}>About</Link>
            </Nav>
          </HeaderInner>
        </div>
      </HeaderWrap>

      <Main>
        <div className="container">{children}</div>
      </Main>

      <FooterWrap>
        <div className="container small">© 2025 FE Chapter · 공통 레이아웃 데모</div>
      </FooterWrap>
    </>
  );
}
```

**작은 CSS-in-JS 컴포넌트 예시**

**`src/components/Badge.tsx`**

```tsx
import styled, { css } from 'styled-components';

export const Badge = styled.span<{ tone?: 'indigo'|'red'|'cyan' }>`
  font-size:12px; padding:2px 8px; border-radius:999px;
  ${({ tone }) => {
    if (tone === 'red')   return css`background:#fee2e2; color:#991b1b;`;
    if (tone === 'cyan')  return css`background:#ecfeff; color:#155e75;`;
    return css`background:#eef2ff; color:#3730a3;`; // indigo default
  }}
`;
```

---

## 5) 페이지 & 앱 엔트리

**`src/pages/_app.tsx`**

```tsx
import type { AppProps } from 'next/app';
import '../styles/globals.css';
import Layout from '../components/Layout';

// 페이지별 레이아웃을 허용하는 getLayout 패턴도 지원
export type NextPageWithLayout<P = {}, IP = P> = React.FC<P> & {
  getLayout?: (page: React.ReactElement) => React.ReactNode;
};
type AppPropsWithLayout = AppProps & { Component: NextPageWithLayout };

export default function MyApp({ Component, pageProps }: AppPropsWithLayout) {
  const getLayout = Component.getLayout ?? ((page) => <Layout>{page}</Layout>);
  return getLayout(<Component {...pageProps} />);
}
```

**`src/pages/index.tsx`**

```tsx
import { Badge } from '../components/Badge';

export default function Home() {
  return (
    <section className="card" style={{ display:'grid', gap:10 }}>
      <h1 style={{ margin:0 }}>공통 레이아웃이 적용된 홈</h1>
      <p className="small">Header/Footer는 모든 페이지에서 공유됩니다.</p>
      <div style={{ display:'flex', gap:6 }}>
        <Badge>New</Badge>
        <Badge tone="red">Hot</Badge>
        <Badge tone="cyan">Beta</Badge>
      </div>
    </section>
  );
}
```

**`src/pages/about.tsx`**

```tsx
export default function About() {
  return (
    <section className="card" style={{ display:'grid', gap:8 }}>
      <h2 style={{ margin:0 }}>About</h2>
      <p className="small">이 페이지 역시 동일한 레이아웃(헤더/푸터)을 사용합니다.</p>
    </section>
  );
}
```

> 실행: `npm run dev` → `http://localhost:3000`
> 기대: 모든 페이지에 **Header/Footer**가 붙고, 중앙 영역에 페이지 콘텐츠가 들어가는 **공통 레이아웃**이 동작합니다.

---

## 6) 실습 미션 (Hands-on)

1. **레이아웃 그리드화**

   * 사이드바가 있는 2열 레이아웃으로 확장(좌측 고정 너비, 우측 유동).
   * `Layout`에 `children` 외에 `sidebar` prop을 받아 렌더하거나, `getLayout`을 이용해 About만 2열로 구성.

2. **Active Nav 강화**

   * 현재 경로가 하위경로(`/posts/*`)여도 Blog 탭이 활성화되도록 `pathname.startsWith('/posts')` 로직 추가.

3. **다크 모드 토글 버튼**

   * Header에 “🌙/☀️” 토글 버튼 추가 → `document.documentElement.dataset.theme` 토글.
   * 버튼 포커스 스타일을 전역 CSS 변수(`--ring`)로 맞추기.

4. **레이아웃 분기(getLayout 패턴)**

   * 신규 페이지 `pages/landing.tsx`를 만들고, 해당 페이지에서만 **풀블리드(헤더 없는) 레이아웃**을 적용.

5. **SEO 헤드 구성**

   * 각 페이지에 `next/head`로 `title`/`meta`를 지정. 공통 기본값은 `_app` 또는 커스텀 `_document`에서 정의.

---

## 7) 자주 하는 실수 & 베스트 프랙티스

* **전역 CSS 남용**: 컴포넌트별 스타일은 **CSS 모듈/Styled-Components**로 캡슐화하고, 전역엔 토큰/리셋만.
* **링크 스타일링 이슈**: Next의 `Link`는 `className`을 전달하므로 **클래스 토글 방식**이 단순합니다.
* **FOUC(깜빡임)**: 다크 모드 초기값은 **최초 페인트 전** 설정(예: `_document` 스크립트, 또는 서버에서 `data-theme` 세팅)으로 줄이기.
* **레이아웃 재사용**: 페이지별 레이아웃이 다양하면 **getLayout 패턴**으로 분기해 `_app`를 깔끔하게 유지.

---

## 8) 예상 질문(Q\&A)

**Q1. Pages Router 대신 App Router를 쓰면 레이아웃은 어떻게 하나요?**
A. App Router에선 `app/layout.tsx`가 **중첩 레이아웃**을 공식 지원합니다. Pages Router는 `_app.tsx` + `getLayout` 패턴으로 유사한 구조를 구성합니다.

**Q2. styled-components 말고 Emotion/Tailwind와도 함께 쓸 수 있나요?**
A. 가능합니다. 팀 표준/디자인 토큰 전략에 따라 선택하세요. 공통 레이아웃은 어떤 스타일 도구로도 동일한 패턴입니다.

**Q3. 다크 모드 상태를 Context로 뺄까요?**
A. 전역으로 자주 읽지만 드물게 바뀌는 값이라면 **Context**가 적합합니다(이전 장 참고). 초기 페인트 전 상태 주입만 주의하세요.

**Q4. 페이지마다 헤더를 숨기고 싶으면?**
A. 해당 페이지 컴포넌트에 `getLayout`을 정의하여 `<Layout>`이 아닌 **대체 레이아웃**(혹은 단독 페이지)을 반환하세요.

---

## (부록) Vite(React)로 동일 패턴 맛보기 — 선택 실습

> Next.js가 아닌 **React + Vite + TS**에서 Header/Footer 공통 레이아웃을 연습하려면:

```bash
npm create vite@latest react-layout-ts -- --template react-swc-ts
cd react-layout-ts && npm i styled-components && npm run dev
```

* `src/App.tsx`에서 `<Layout>`로 감싸고, 라우팅은 `react-router-dom`을 추가하여 `Header/Footer + <Outlet>` 패턴으로 구현하면 본 장의 레이아웃 개념을 그대로 체험할 수 있습니다.


