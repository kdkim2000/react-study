# 09. 라우팅 (React Router)

## 1) React Router 기초

### 왜 라우터가 필요한가?

SPA(Single Page Application)는 한 번 로드된 뒤 **URL만 바꾸며 다른 화면**을 보여줍니다. 라우터는 다음을 담당합니다.

* URL ↔ 컴포넌트 매핑
* **중첩 레이아웃**(상단/사이드 공통 + 내부 페이지 교체)
* **동적 라우트 파라미터**(`/posts/:slug`)
* (데이터 라우터 기준) **라우트 단위 데이터 로딩/에러 핸들링**

### 핵심 개념 한 줄 요약

* `createBrowserRouter` + `RouterProvider`로 라우터를 구성.
* `RouteObject` 트리에서 `children`을 쓰면 **중첩 라우팅**(레이아웃 + `Outlet`)이 된다.
* `Link`/`NavLink`로 페이지 이동, `useNavigate`로 코드에서 이동.
* `useParams`로 `:slug` 같은 동적 파라미터 읽기.
* `loader`에서 **데이터를 미리 로드**하고, `useLoaderData`로 꺼내 쓰기.
* `errorElement`로 라우트 단위 에러 UI 제공.

---

## 2) 페이지 이동과 동적 라우팅

* 정적 경로: `/`, `/about`, `/blog`
* 동적 경로: `/blog/:slug`
* 중첩 레이아웃: `/blog` 하위에 `index`(목록)와 `:slug`(상세)를 넣고, 상위 `BlogLayout`에서 `Outlet`으로 하위 페이지를 렌더링.

---

## 3) 실습: 다중 페이지 블로그 (목록/상세, 동적 라우트, 데이터 로더)

### 3-1) 프로젝트 초기화

```bash
npm create vite@latest react-router-blog-ts -- --template react-swc-ts
cd react-router-blog-ts
npm i react-router-dom
npm i
npm run dev
```

### 3-2) 폴더 구조

```
src/
├─ main.tsx
├─ AppRouter.tsx             # 라우터 구성
├─ layouts/
│  ├─ RootLayout.tsx
│  └─ BlogLayout.tsx
├─ pages/
│  ├─ HomePage.tsx
│  ├─ AboutPage.tsx
│  ├─ BlogIndexPage.tsx      # 블로그 목록
│  ├─ BlogPostPage.tsx       # 블로그 상세
│  └─ ErrorPage.tsx
├─ lib/
│  └─ blog.ts                # 가짜 데이터 + fetch 유틸
└─ index.css
```

---

### 3-3) 가짜 데이터 & 로딩 유틸

**`src/lib/blog.ts`**

```ts
export type Post = {
  id: string;
  slug: string;
  title: string;
  excerpt: string;
  body: string;
  date: string;      // ISO
  tags: string[];
};

const POSTS: Post[] = [
  {
    id: '1',
    slug: 'hello-react-router',
    title: 'Hello React Router',
    excerpt: 'React Router로 SPA 라우팅 시작하기',
    body: '첫 글입니다. 라우팅의 기본 개념과 목적을 소개합니다.',
    date: '2025-08-20',
    tags: ['react', 'router']
  },
  {
    id: '2',
    slug: 'data-loading-with-loaders',
    title: 'Loader로 데이터 로딩하기',
    excerpt: 'route-level 데이터 로딩과 에러 처리',
    body: 'loader에서 데이터를 불러오고 useLoaderData로 사용하는 방법.',
    date: '2025-08-21',
    tags: ['data', 'loader']
  },
  {
    id: '3',
    slug: 'dynamic-routes-and-params',
    title: '동적 라우트와 파라미터',
    excerpt: 'URL 파라미터로 상세 페이지 만들기',
    body: 'useParams로 slug를 읽고 맞는 글을 찾는 예제.',
    date: '2025-08-22',
    tags: ['route', 'params']
  },
];

function delay(ms: number) {
  return new Promise((res) => setTimeout(res, ms));
}

export async function fetchPosts() {
  await delay(200); // 로딩 체감
  // 보통은 API 호출(fetch/axios) 후 JSON 파싱
  return POSTS;
}

export async function fetchPostBySlug(slug: string) {
  await delay(120);
  return POSTS.find((p) => p.slug === slug) ?? null;
}
```

---

### 3-4) 레이아웃 (상단 내비 + Outlet)

**`src/layouts/RootLayout.tsx`**

```tsx
import { NavLink, Outlet } from 'react-router-dom';

function navStyle({ isActive }: { isActive: boolean }) {
  return {
    padding: '6px 10px',
    borderRadius: 8,
    textDecoration: 'none',
    color: isActive ? '#fff' : '#111',
    background: isActive ? '#111' : '#f3f4f6',
    border: '1px solid #e5e7eb',
  };
}

export default function RootLayout() {
  return (
    <div style={{ fontFamily: 'system-ui', lineHeight: 1.5 }}>
      <header style={{ display: 'flex', gap: 8, alignItems: 'center', padding: 16 }}>
        <h1 style={{ margin: 0, fontSize: 20 }}>React Router Blog</h1>
        <nav style={{ display: 'flex', gap: 8, marginLeft: 'auto' }}>
          <NavLink to="/" style={navStyle} end>Home</NavLink>
          <NavLink to="/blog" style={navStyle}>Blog</NavLink>
          <NavLink to="/about" style={navStyle}>About</NavLink>
        </nav>
      </header>

      <main style={{ maxWidth: 900, margin: '0 auto', padding: 16 }}>
        <Outlet />
      </main>

      <footer style={{ padding: 16, color: '#6b7280' }}>
        © 2025 FE Chapter
      </footer>
    </div>
  );
}
```

**`src/layouts/BlogLayout.tsx`**

```tsx
import { Outlet } from 'react-router-dom';

export default function BlogLayout() {
  return (
    <section style={{ display: 'grid', gap: 16 }}>
      <h2>블로그</h2>
      <Outlet />
    </section>
  );
}
```

---

### 3-5) 페이지들

**`src/pages/HomePage.tsx`**

```tsx
import { Link } from 'react-router-dom';

export default function HomePage() {
  return (
    <section style={{ display: 'grid', gap: 12 }}>
      <h2>홈</h2>
      <p>React Router로 만든 간단한 블로그 데모입니다.</p>
      <Link to="/blog">블로그 바로가기 →</Link>
    </section>
  );
}
```

**`src/pages/AboutPage.tsx`**

```tsx
export default function AboutPage() {
  return (
    <section style={{ display: 'grid', gap: 8 }}>
      <h2>About</h2>
      <p>부서 교육용 React Router 데모. 목록/상세/동적 라우트를 포함합니다.</p>
    </section>
  );
}
```

**`src/pages/ErrorPage.tsx`**

```tsx
import { isRouteErrorResponse, useRouteError } from 'react-router-dom';

export default function ErrorPage() {
  const error = useRouteError();
  let message = '알 수 없는 오류가 발생했습니다.';
  if (isRouteErrorResponse(error)) {
    message = `${error.status} ${error.statusText}`;
  } else if (error instanceof Error) {
    message = error.message;
  }
  return (
    <div role="alert" style={{ color: 'crimson' }}>
      <h2>오류</h2>
      <p>{message}</p>
    </div>
  );
}
```

---

### 3-6) 라우트 단위 데이터 로딩 (목록/상세)

**`src/pages/BlogIndexPage.tsx`**

```tsx
import { Link, useLoaderData, useSearchParams } from 'react-router-dom';
import type { Post } from '../lib/blog';
import { fetchPosts } from '../lib/blog';

export async function blogIndexLoader() {
  const posts = await fetchPosts();
  return posts;
}

export default function BlogIndexPage() {
  const posts = useLoaderData() as Post[];
  const [params, setParams] = useSearchParams();   // 쿼리(검색/정렬)에 사용

  const q = (params.get('q') ?? '').toLowerCase();
  const filtered = posts.filter(
    (p) =>
      p.title.toLowerCase().includes(q) ||
      p.excerpt.toLowerCase().includes(q) ||
      p.tags.some((t) => t.includes(q))
  );

  return (
    <div style={{ display: 'grid', gap: 12 }}>
      <div style={{ display: 'flex', gap: 8 }}>
        <input
          value={q}
          placeholder="검색어(제목/요약/태그)"
          onChange={(e) => setParams({ q: e.target.value })}
          style={{ flex: 1, padding: 8, borderRadius: 8, border: '1px solid #e5e7eb' }}
          aria-label="검색"
        />
      </div>

      {filtered.length === 0 && <p style={{ color: '#6b7280' }}>검색 결과가 없습니다.</p>}

      <ul style={{ listStyle: 'none', padding: 0, display: 'grid', gap: 12 }}>
        {filtered.map((p) => (
          <li key={p.id} style={{ border: '1px solid #eee', borderRadius: 12, padding: 12 }}>
            <div style={{ display: 'flex', gap: 8, alignItems: 'baseline' }}>
              <h3 style={{ margin: 0 }}>{p.title}</h3>
              <small style={{ color: '#6b7280' }}>{new Date(p.date).toLocaleDateString()}</small>
            </div>
            <p style={{ margin: '6px 0', color: '#4b5563' }}>{p.excerpt}</p>
            <div style={{ display: 'flex', gap: 6, flexWrap: 'wrap' }}>
              {p.tags.map((t) => (
                <span key={t} style={{ fontSize: 12, background: '#eef2ff', color: '#3730a3', padding: '2px 8px', borderRadius: 999 }}>{t}</span>
              ))}
            </div>
            <div style={{ marginTop: 8 }}>
              <Link to={`/blog/${p.slug}`}>자세히 보기 →</Link>
            </div>
          </li>
        ))}
      </ul>
    </div>
  );
}
```

**`src/pages/BlogPostPage.tsx`**

```tsx
import { Link, LoaderFunctionArgs, redirect, useLoaderData, useParams } from 'react-router-dom';
import type { Post } from '../lib/blog';
import { fetchPostBySlug } from '../lib/blog';

export async function blogPostLoader({ params }: LoaderFunctionArgs) {
  const slug = params.slug!;
  const post = await fetchPostBySlug(slug);
  if (!post) {
    // 존재하지 않는 글이면 목록으로 보내거나, throw Response로 404 처리 가능
    throw new Response('Post not found', { status: 404, statusText: 'Not Found' });
    // 또는: return redirect('/blog');
  }
  return post;
}

export default function BlogPostPage() {
  const { slug } = useParams();
  const post = useLoaderData() as Post;

  return (
    <article style={{ display: 'grid', gap: 10 }}>
      <Link to="/blog">← 목록으로</Link>
      <h2 style={{ marginBottom: 0 }}>{post.title}</h2>
      <small style={{ color: '#6b7280' }}>
        {new Date(post.date).toLocaleString()} • {post.tags.join(', ')}
      </small>
      <p style={{ marginTop: 8 }}>{post.body}</p>
      <hr />
      <p style={{ color: '#6b7280' }}>
        slug: <code>{slug}</code>
      </p>
    </article>
  );
}
```

---

### 3-7) 라우터 구성

**`src/AppRouter.tsx`**

```tsx
import { createBrowserRouter, RouterProvider } from 'react-router-dom';
import RootLayout from './layouts/RootLayout';
import BlogLayout from './layouts/BlogLayout';
import HomePage from './pages/HomePage';
import AboutPage from './pages/AboutPage';
import ErrorPage from './pages/ErrorPage';
import BlogIndexPage, { blogIndexLoader } from './pages/BlogIndexPage';
import BlogPostPage, { blogPostLoader } from './pages/BlogPostPage';

const router = createBrowserRouter([
  {
    path: '/',
    element: <RootLayout />,
    errorElement: <ErrorPage />,
    children: [
      { index: true, element: <HomePage /> },
      { path: 'about', element: <AboutPage /> },
      {
        path: 'blog',
        element: <BlogLayout />,
        children: [
          { index: true, element: <BlogIndexPage />, loader: blogIndexLoader },
          { path: ':slug', element: <BlogPostPage />, loader: blogPostLoader },
        ],
      },
      { path: '*', element: <ErrorPage /> }, // 404 fallback
    ],
  },
]);

export default function AppRouter() {
  return <RouterProvider router={router} />;
}
```

**`src/main.tsx`**

```tsx
import { createRoot } from 'react-dom/client';
import AppRouter from './AppRouter';
import './index.css';

createRoot(document.getElementById('root')!).render(<AppRouter />);
```

> 실행 포인트
>
> * `/blog`에서 **목록**을 보고 검색어를 쿼리스트링(`?q=`)으로 관리
> * `/blog/:slug`로 이동하면 **동적 라우트** + `loader`로 데이터 로딩
> * 로딩/에러가 발생하면 라우트 단위로 **ErrorPage**가 표시

---

## 4) 실습 미션 (Hands-on)

1. **카테고리 라우트 추가**

   * 경로: `/blog/c/:tag`
   * 로더에서 `tag`로 필터링 후 목록 렌더링. 상단에 현재 태그 배지 표시.

2. **이전/다음 글 내비게이션**

   * 상세에서 `이전 글/다음 글` 링크 제공. 현재 글의 인덱스를 찾아 양옆 글로 이동.

3. **스크롤 복원**

   * 상세 → 목록으로 돌아왔을 때 이전 스크롤 위치를 기억해 복원(간단히 `sessionStorage`에 저장 후 복원).

4. **코드 분할(지연 로딩)**

   * `React.lazy` + `Suspense`로 Blog 관련 페이지를 지연 로딩. 목록에서 상세 진입 시 청크가 로드되는지 네트워크 탭으로 확인.

5. **마크다운 렌더링(선택)**

   * `marked` 또는 `markdown-it` 같은 라이브러리로 `post.body`를 마크다운으로 렌더링하고 스타일 적용.

---

## 5) 자주 하는 실수 & 베스트 프랙티스

* **중첩 라우팅 누락**: 상위 레이아웃에서 `Outlet`을 잊지 말기.
* **동적 파라미터 타입**: `params.slug!` 처럼 non-null 단언을 쓸 땐 **실제 존재**가 보장되는지 확인. 가능하면 **검증 후 에러 처리**.
* **데이터 패칭 위치**: 화면 진입 전에 데이터를 준비하려면 **loader**가 적합. 컴포넌트 마운트 후 패칭이 필요하면 `useEffect`.
* **에러 처리**: 로더 내부에서 `throw new Response(...)`로 **상태 코드 포함** 에러를 던지면 `errorElement`에서 잡아 일관 처리.
* **링크 활성화 스타일링**: `NavLink`의 `isActive` 스타일/클래스 함수를 적극 활용.

---

## 6) 예상 질문(Q\&A)

**Q1. `BrowserRouter` 대신 `createBrowserRouter`를 쓰는 이유는?**
A. `createBrowserRouter`(데이터 라우터)는 라우트 정의에서 **loader/action/errorElement** 등을 함께 선언해 **데이터 로딩과 라우팅을 밀착**시킵니다. 페이지 전환 시 **사전 로드 및 에러 경로**가 명확해집니다.

**Q2. 쿼리스트링을 상태로 써도 되나요?**
A. 검색/정렬/페이지 같은 UI 상태는 **URL 쿼리로 표현**하면 **북마크/공유/뒤로가기**가 자연스럽습니다. `useSearchParams`를 사용하세요.

**Q3. 로더에서 API 에러가 나면?**
A. `throw new Response('...', {status: 500})`처럼 에러를 던지면 해당 라우트의 `errorElement`가 렌더됩니다. 공통 에러 UI를 상위 라우트에 두면 하위가 재사용합니다.

**Q4. SEO는 어떻게 하나요?**
A. SPA 자체로는 CSR이라 SEO에 제한이 있습니다. 서버에서 렌더링(SSR)이 필요하면 **Next.js** 같은 메타 프레임워크를 사용하세요. (이후 Next.js 파트에서 다룹니다)

**Q5. 리스트가 엄청 크면 느려집니다.**
A. 페이지네이션, **가상 스크롤**(react-window/react-virtualized), 메모이제이션(필터/정렬)을 도입하세요.


